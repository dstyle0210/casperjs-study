<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.3.4/vue.min.js"></script>
</head>
<body>
<style>
ul.lists{width:100%;overflow:hidden;}
ul.lists>li{width:100%;overflow:hidden;}
.sneakers{width:100%;overflow:hidden;}
.sneaker{position:relative;float:left;margin-left:5px;border:1px solid #ccc;box-sizing:border-box;padding:10px;width:150px;height:250px;overflow:hidden;}
.sneaker .photo{width:130px;height:130px;overflow:hidden;background:#f5f5f5;}
.sneaker .photo img{width:100%;height:auto;}
.sneaker p{font-size:13px;}
.sneaker .store{display:inline-block;position:absolute;top:0;right:0;font-size:12px;font-family:tahoma;padding:3px 5px;}
.sneaker .store.eastbay{background:#f6d046;}
.sneaker .store.footlocker{background:#e71836;color:#fff;}
</style>
<div id="sneaker">
    <ul>
        <li v-for="month in sneakers">
            <h2>{{month.title}}</h2>
            <ul class="lists">
                <li v-for="day in month.days">
                    <h3>{{day.title}}</h3>
                    <div class="sneakers">
                        <article v-for="sneaker in day.lists" class="sneaker">
                            <div class="photo"><img :src="sneaker.image" alt="" onerror="this.style.display='none';" width="100" height="100" /></div>
                            <span class="store" :class="sneaker.store">{{sneaker.store}}</span>
                            <p>{{sneaker.name}}</p>
                        </article>
                    </div>
                </li>
            </ul>
        </li>
    </ul>
</div>
<script>
var promise1 = new Promise(function(res,rej){
    $.ajax({
        url: "./SneakerReleaseCalendar/eastbay.json",
        beforeSend: function( xhr ) {
            console.log("eastBay Start");
        }
    }).done(function( data ) {
        res(data);
    });
});
var promise2 = new Promise(function(res,rej){
    $.ajax({
        url: "./SneakerReleaseCalendar/footlocker.json",
        beforeSend: function( xhr ) {
            console.log("FootLocker Start");
        }
    }).done(function( data ) {
        res(data);
    });
});
Promise.all([promise1, promise2]).then(function (values) {

    var merge = values[0].concat(values[1]);
    var sneakers = {}
    $.each(merge,function(idx,SK){
        if(idx==0){ console.log(SK); };
        // 월 설정
        if(!sneakers[SK.year+"-"+SK.month]){ // 기존에 없으면
            sneakers[SK.year+"-"+SK.month] = { title:SK.year+"-"+SK.month , days:{} };
        };
        // 일설정
        if(!sneakers[SK.year+"-"+SK.month].days[SK.day]){
            sneakers[SK.year+"-"+SK.month].days[SK.day] = {title:SK.day,lists:[]};
        };
        sneakers[SK.year+"-"+SK.month].days[SK.day].lists.push(SK);
        // console.log(SK);
    });

    $.each(sneakers,function(idx,month){
        var data = month.days;
        var ordered = {};
        Object.keys(data).sort().forEach(function(key) {
            ordered[key] = data[key];
        });
        console.log(ordered);
    });



    console.log(sneakers);

    console.log("모두 완료됨", values);
    var app = new Vue({
        el: '#sneaker',
        data: {
            sneakers:sneakers
        }
    })
});



</script>
</body>
</html>